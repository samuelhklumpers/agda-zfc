{-# OPTIONS --safe #-}

module Basics where

open import Data.Maybe
open import Data.Fin.Properties
open import Data.Empty
open import Relation.Nullary
open import Relation.Binary.PropositionalEquality hiding ([_])

open import ZFC
open import Showing

private variable
  P Q : Set
  n m : â„•
  i j : Fin n
  Ï• Ïˆ : Form n
  Î“ Î” : Cxt n m
  t s : Term n

-- alternative formulations
âˆƒ-eâ€² : n , Î“ âŠ¢ âˆƒf Ï• â†’ n , Î“ âŠ¢ âˆ€f (Ï• â‡’ bumpForm Ïˆ) â†’ n , Î“ âŠ¢ Ïˆ
âˆƒ-eâ€² {Ï• = Ï•} p q =
  âˆƒ-e
    p
    (â‡’-e
      Ï•
      (weak (CxtâŠ‚-right CxtâŠ‚-refl) (âˆ€-e q))
      (ğ•§-i â–·z))

â‡’-eâ€² : n , Î“ âŠ¢ Ï• â‡’ Ïˆ â†’ n , Î“ âŠ¢ Ï• â†’ n , Î“ âŠ¢ Ïˆ
â‡’-eâ€² = â‡’-e _

~-eâ€² : n , Î“ âŠ¢ ~ Ï• â†’ n , Î“ âŠ¢ Ï• â†’ n , Î“ âŠ¢ âŠ¥â€²
~-eâ€² = ~-e _

-- weaker formulation
âˆ€-ew : n , Î“ âŠ¢ âˆ€f Ï• â†’ âˆ€ t â†’ n , Î“ âŠ¢ Ï• [ # 0 := t ]
âˆ€-ew p t = h1l (subv (âˆ€-e p) (# 0) t)

-- preliminaries
dne : n , Î“ âŠ¢ ~ ~ Ï• â‡’ Ï•
dne {Ï• = Ï•} = â‡’-i (âˆ¨-e (lem Ï•) (ğ•§-i â–·z) (âŠ¥-e (~-eâ€² (ğ•§-i (â–·s â–·z)) (ğ•§-i â–·z))))

case : âˆ€ Ï• {Ïˆ} â†’ n , Î“ â—‚ Ï• âŠ¢ Ïˆ â†’ n , Î“ â—‚ ~ Ï• âŠ¢ Ïˆ â†’ n , Î“ âŠ¢ Ïˆ
case Ï• p q = âˆ¨-e (lem Ï•) p q

â‡’-refl : n , Î“ âŠ¢ Ï• â‡’ Ï•
â‡’-refl = â‡’-i (ğ•§-i â–·z)

ï¼-refl : n , Î“ âŠ¢ âˆ€f (ğ•§ # 0 ï¼ ğ•§ # 0)
ï¼-refl = âˆ€-i (â‡’-eâ€² (âˆ€-ew (âˆ€-ew ext _) _) (âˆ€-i (âˆ§-i
  â‡’-refl
  â‡’-refl
  )))

ï¼-sym : n , Î“ âŠ¢ âˆ€f âˆ€f (ğ•§ # 1 ï¼ ğ•§ # 0 â‡’ ğ•§ # 0 ï¼ ğ•§ # 1)
ï¼-sym = âˆ€-i (âˆ€-i (â‡’-i (subs (ğ•§ # 2 ï¼ ğ•§ # 1) (# 2) (ğ•§-i â–·z) (âˆ€-ew ï¼-refl (ğ•§ # 1)))))

ï¼-trans : n , Î“ âŠ¢ âˆ€f âˆ€f âˆ€f ğ•§ # 2 ï¼ ğ•§ # 1 â‡’ ğ•§ # 1 ï¼ ğ•§ # 0 â‡’ ğ•§ # 2 ï¼ ğ•§ # 0
ï¼-trans = âˆ€-i (âˆ€-i (âˆ€-i (â‡’-i (â‡’-i (subs (ğ•§ (# 3) ï¼ ğ•§ (# 1)) (# 1) (ğ•§-i â–·z) (ğ•§-i (â–·s â–·z)))))))

xâˆˆ[x] : n , Î“ âŠ¢ âˆ€f ğ•§ # 0 âˆˆ [ ğ•§ # 0 ]
xâˆˆ[x] = âˆ€-i (â‡’-eâ€² (âˆ§-el (âˆ€-ew (âˆ€-ew (âˆ€-ew pair (ğ•§ fz)) (ğ•§ fz)) (ğ•§ (# 0)))) (âˆ¨-il (âˆ€-ew ï¼-refl (ğ•§ # 0))))

xâˆˆ[x]! : n , Î“ âŠ¢ âˆ€f âˆ€f ğ•§ # 0 âˆˆ [ ğ•§ # 1 ] â‡’ ğ•§ # 0 ï¼ ğ•§ # 1
xâˆˆ[x]! = âˆ€-i (âˆ€-i (â‡’-i (âˆ¨-e (â‡’-eâ€² (âˆ§-er (âˆ€-ew (âˆ€-ew (âˆ€-ew pair (ğ•§ # 1)) (ğ•§ # 1)) (ğ•§ # 0))) (ğ•§-i â–·z)) (ğ•§-i â–·z) (ğ•§-i â–·z))))

xâˆ‰x : n , Î“ âŠ¢ âˆ€f ~ ğ•§ # 0 âˆˆ ğ•§ # 0
xâˆ‰x = âˆ€-i (~-i (âˆƒ-eâ€² (â‡’-eâ€² (âˆ€-ew reg [ ğ•§ # 0 ]) (âˆƒ-i (ğ•§ # 0) (âˆ€-ew xâˆˆ[x] (ğ•§ # 0)))) (âˆ€-i (â‡’-i (~-eâ€² (âˆ§-er (ğ•§-i â–·z)) (âˆƒ-i (ğ•§ # 1)
  (âˆ§-i (subs (ğ•§ (# 1) âˆˆ ğ•§ (# 2)) (# 2) (â‡’-eâ€² (âˆ€-ew (âˆ€-ew ï¼-sym _) _) (â‡’-eâ€² (âˆ€-ew (âˆ€-ew xâˆˆ[x]! _) _) (âˆ§-el (ğ•§-i â–·z)))) (ğ•§-i (â–·s â–·z))) (âˆ€-ew xâˆˆ[x] (ğ•§ # 1)))))))))

âŸ¨xâˆ£âŠ¥âŸ©-empty : n , Î“ âŠ¢ âˆ€f âˆ€f ~ ğ•§ # 0 âˆˆ âŸ¨ ğ•§ # 1 âˆ£ âŠ¥â€² âŸ©
âŸ¨xâˆ£âŠ¥âŸ©-empty = âˆ€-i (âˆ€-i (~-i (âˆ§-er (â‡’-eâ€² (âˆ§-er (âˆ€-ew (sep âŠ¥â€² (ğ•§ # 1)) (ğ•§ (# 0)))) (ğ•§-i â–·z)))))

_Ã—_ : (x y : Term n) â†’ Term n
x Ã— y = âŸ¨ ğ’« ğ’« (x âˆª y) âˆ£ âˆƒf (âˆƒf ğ•§ (# 0) âˆˆ liftTerm x âˆ§ (ğ•§ (# 1) âˆˆ liftTerm y âˆ§ ğ•§ (# 2) ï¼ [ ğ•§ # 0 , ğ•§ # 1 ])) âŸ© 

âˆ€[âˆˆ_]_ : Term n â†’ Form (1 + n) â†’ Form n
âˆ€[âˆˆ t ] Ï• = âˆ€f ğ•§ # 0 âˆˆ (bumpTerm t) â‡’ Ï•

âˆƒ[âˆˆ_]_ : Term n â†’ Form (1 + n) â†’ Form n
âˆƒ[âˆˆ t ] Ï• = âˆƒf ğ•§ # 0 âˆˆ (bumpTerm t) âˆ§ Ï•

infix 4 âˆ€[âˆˆ_]_ âˆƒ[âˆˆ_]_

Rel : (x y r : Term n) â†’ Form n
Rel x y r = r âŠ‚ (x Ã— y)

Fun : (x y r : Term n) â†’ Form n
Fun x y r = Rel x y r âˆ§ (âˆ€[âˆˆ x ] âˆƒ[âˆˆ â†‘ y ] (âˆ€[âˆˆ â†‘ y ] [ ğ•§ # 2 , ğ•§ # 0 ] âˆˆ â†‘ r â‡’ ğ•§ # 0 ï¼ ğ•§ # 1))

_âŸ¶_ : Term n â†’ Term n â†’ Term n
x âŸ¶ y = âŸ¨ ğ’« (x Ã— y) âˆ£ Fun (â†‘ x) (â†‘ y) (ğ•§ # 0) âŸ©

{-
-- SMP 130
tuple-ï¼ : âŠ¢â€³ âˆ€f âˆ€f âˆ€f âˆ€f [ ğ•§ # 0 , ğ•§ # 1 ] ï¼ [ ğ•§ # 2 , ğ•§ # 3 ] â‡” (ğ•§ # 0 ï¼ ğ•§ # 2 âˆ§ ğ•§ # 1 ï¼ ğ•§ # 3)
tuple-ï¼ = âˆ€-i (âˆ€-i (âˆ€-i (âˆ€-i (âˆ§-i
  (â‡’-i (âˆ§-i
    {!!} -- first need well-foundedness, and is actually fairly tricky
    {!!}))
  (â‡’-i (â‡’-eâ€² (âˆ€-ew (âˆ€-ew ext [ ğ•§ # 2 , ğ•§ # 3 ]) [ ğ•§ # 0 , ğ•§ # 1 ]) (âˆ€-i (âˆ§-i
    (â‡’-i (subs (ğ•§ (# 0) âˆˆ [ ğ•§ (# 1) , ğ•§ (# 5) ]) (# 1) (âˆ§-el (ğ•§-i (â–·s â–·z)))
         (subs (ğ•§ (# 0) âˆˆ [ ğ•§ (# 1) , ğ•§ (# 2) ]) (# 2) (âˆ§-er (ğ•§-i (â–·s â–·z)))
         (ğ•§-i â–·z))))
    (â‡’-i (subs (ğ•§ (# 0) âˆˆ [ ğ•§ (# 1) , ğ•§ (# 3) ]) (# 1) (â‡’-eâ€² (âˆ€-ew (âˆ€-ew ï¼-sym _) _) (âˆ§-el (ğ•§-i (â–·s â–·z))))
         (subs (ğ•§ (# 0) âˆˆ [ ğ•§ (# 4) , ğ•§ (# 2) ]) (# 2) (â‡’-eâ€² (âˆ€-ew (âˆ€-ew ï¼-sym _) _) (âˆ§-er (ğ•§-i (â–·s â–·z)))) (ğ•§-i â–·z))))
    ))))
  ))))
-}
